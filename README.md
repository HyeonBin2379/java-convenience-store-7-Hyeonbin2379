# java-convenience-store-precourse

# 1. 편의점 결제 시스템의 동작 양상 정리

* 구매자의 할인 혜택과 재고 상황을 고려하여 최종 결제 금액을 계산하고 안내하는 결제 시스템을 구현한다.

* 사용자가 입력한 상품의 가격과 수량을 기반으로 최종 결제 금액을 계산한다.
  * 편의점에서 구매 가능한 상품의 이름은 고유한 것으로 간주한다.
  * 총구매액은 상품별 가격과 수량을 먼저 곱한 후, 프로모션 및 멤버십 할인 정책을 반영하는 식으로 계산한다.
  * 오늘 적용 가능한 프로모션 재고를 찾고, 적용 가능한 프로모션 재고가 없으면 일반 재고를 불러온다. 
* 구매 내역과 산출한 금액 정보를 영수증으로 출력한다.
* 영수증 출력 후 추가 구매를 진행할지 또는 종료할지를 선택할 수 있다.
* 사용자가 잘못된 값을 입력할 경우 `IllegalArgumentException`를 발생시키고, `[ERROR]`로 시작하는 에러 메시지를 출력 후 그 부분부터 입력을 다시 받는다.
* `Exception`이 아닌 `IllegalArgumentException`, `IllegalStateException` 등과 같은 명확한 유형을 처리한다.

----

## 재고 관리 & 상품 구매

* 상품 구매는 구매할 상품의 재고에서 구매한 수량만큼을 차감하는 것이다.

* 각 상품의 재고 수량을 고려하여 결제 가능 여부를 확인한다.
  * 프로모션 재고와 일반 재고의 수량의 합이 입력한 구매 수량보다 적으면 `IllegalArgumentException`이 발생한다.
* 다음 고객이 구매할 때는 차감된 재고를 출력해야 한다. 이때 재고가 0이면 `재고 없음`으로 표기해야 한다.


## 프로모션 할인

* 프로모션 할인 적용은 프로모션 상품을 구매할 때마다 지정된 무료 증정 수량만큼을 증가시키는 것이다.

* 오늘 날짜가 프로모션 기간 내에 포함될 때만 해당 프로모션 재고를 이용할 수 있다.
  * 프로모션 기간 중이면 프로모션 혜택 적용 여부에 관계없이 프로모션 재고를 우선 차감한다.
  * 프로모션 할인 금액은 지급된 증정용 제품별 수량에 의해 결정된다.

* 프로모션은 n개 구매 시 1개 무료 증정의 형태이다.
  * 구매할 수량이 n+1개와 같거나 많을 경우 프로모션 재고의 수량을 n+1개씩 차감한다.
  * 2+1 프로모션이면 3개를 프로모션 재고 수량에서 차감한 후 1개 구매한 가격을 행사할인 금액에 추가한다.
  * 1+1 프로모션이면 2개를 프로모션 재고 수량에서 차감한 후 1개 구매한 가격을 행사할인 금액에 추가한다.

* 프로모션 상품을 n+1개보다 적게 구매하는 경우 무료 증정을 받을 것인지에 관한 메시지를 출력한다.
  * 프로모션 혜택을 적용하면 구매 수량을 n+1개로 변경하고, 프로모션을 적용한다.
  * 프로모션 혜택을 적용하지 않으면 기존의 구매 수량을 유지하고, 프로모션 적용 없이 프로모션 재고의 수량부터 차감한다.

* 프로모션 상품 구매 도중 프로모션 재고가 부족해질 경우 일반 재고를 사용하며, 일반 재고 사용 시 할인되는 금액은 없다.
  * 이에 해당하는 경우 일반 재고를 사용할 것인지에 대한 메시지를 출력한다.
  * 일반 재고를 사용하지 않을 경우 해당 상품에 대한 구매를 종료한다.


## 멤버십 할인

* 멤버십 할인은 프로모션 할인 이후 적용할 수 있으며, 멤버십 할인에 관한 메시지를 출력한다.
* 멤버십 할인 시 프로모션 미적용 금액의 30%를 할인받으며, 최대 한도는 8,000원이다.
* 프로모션 미적용 금액은 프로모션 미적용 수량에 의해 결정된다.
* 프로모션 미적용 수량은 상품을 프로모션 재고에서 정가로 구매하거나 일반 재고에서 구매할 때 증가한다.


## 영수증 출력

* 영수증은 고객의 구매 내역과 할인을 요약하여 출력한다.
* 영수증 항목은 아래와 같다.
  * 구매 상품 내역: 구매한 상품명, 수량, 가격을 출력한다. 이때의 가격은 할인 이전의 가격이다.
  * 증정 상품 내역: 프로모션에 따라 무료로 제공된 증정 상품의 목록으로, 상품명과 증정 수량을 출력한다.
  * 금액 정보
    * 총구매액: 구매한 상품의 총 수량과 총 금액으로, 할인 이전 가격의 총합이다.
    * 행사할인: 프로모션에 의해 할인된 금액으로, 증정 상품별 개수에 따른 가격의 총합이다.
    * 멤버십할인: 멤버십에 의해 추가로 할인된 금액
    * 내실돈: 총구매액에서 행사할인, 멤버십할인 금액을 차감한 최종 결제 금액
* 영수증의 구성 요소를 보기 좋게 정렬하여 고객이 쉽게 금액과 수량을 확인할 수 있게 한다.

----

# 2. 입력

* 구현에 필요한 상품 목록과 프로모션 행사 목록을 파일 입출력을 통해 불러온다.
  * `src/main/resources/products.md`과 `src/main/resources/promotions.md` 파일을 이용한다.
  * 위의 두 파일 모두 내용과 형식을 유지한다면 값을 수정할 수 있다.

* 구매할 상품과 구매할 수량을 입력받는다. 
  * 상품명과 수량은 하이픈(`-`)으로, 개별 상품은 대괄호로 묶어 (`[]`) 쉼표(`,`)로 구분한다.

* 프로모션 적용이 가능한 상품에 대해 고객이 프로모션을 적용 가능한 수량보다 적게 가져온 경우 그 수량만큼 추가 여부를 입력받는다.
  * 추가 여부는 `Y`나 `N`을 입력하여 결정하며, 그 외의 문자가 입력되면 예외를 발생시킨다.
  * Y: 증정 받을 수 있는 상품을 추가한다.
  * N: 증정 받을 수 있는 상품을 추가하지 않는다.

* 프로모션 재고가 부족해서 일부 수량을 일반 재고에서 정가로 결제할지 여부를 입력받는다.
  * 추가 여부는 `Y`나 `N`을 입력하여 결정하며, 그 외의 문자가 입력되면 예외를 발생시킨다.
  * Y: 일부 수량에 대해 정가로 결제한다.
  * N: 정가로 결제해야 하는 수량은 제외한 채로 결제를 진행한다.

* 멤버십 할인 여부를 입력받는다.
  * 추가 여부는 `Y`나 `N`을 입력하여 결정하며, 그 외의 문자가 입력되면 예외를 발생시킨다.
  * Y: 멤버십 할인을 적용받는다.
  * N: 멤버십 할인을 적용받지 않는다.

* 추가 구매 여부를 입력받는다.
  * 추가 여부는 `Y`나 `N`을 입력하여 결정하며, 그 외의 문자가 입력되면 예외를 발생시킨다.
  * Y: 재고가 업데이트된 상품 목록을 확인한 후 추가 구매를 진행한다.
  * N: 구매를 종료한다.


---

# 3. 출력

* 환영 인사와 함께 상품명, 가격, 재고, 프로모션 이름을 안내한다.
  * 재고가 0개라면 0 대신 `재고 없음`을 출력한다.

* 프로모션 적용 가능 상품에 대해 프로모션이 적용되는 수량보다 적게 가져온 경우 혜택에 대한 안내 메시지를 출력한다.
* 프로모션 재고가 부족해서 일부 수량을 프로모션 혜택 없이 결제할 경우, 정가로 결제할지 여부에 대한 안내 메시지를 출력한다.

* 멤버십 할인 적용 여부를 확인하기 위한 안내 메시지를 출력한다.
* 구매 상품 내역, 증정 상품 내역, 총구매액, 행사할인, 멤버십할인, 총결제금액을 출력한다.

* 추가 구매 여부를 확인하기 위한 안내 메시지를 출력한다.

---

# 4. 에러 메시지

* 사용자가 잘못된 값을 입력하여 예외가 발생하면 `[ERROR]`로 시작되는 오류 메시지를 출력한 후 재입력한다.
* 구매할 상품과 수량 형식이 올바르지 않은 경우: `[ERROR] 올바르지 않은 형식으로 입력했습니다. 다시 입력해 주세요.`
* 존재하지 않는 상품을 입력한 경우: `[ERROR] 존재하지 않는 상품입니다. 다시 입력해 주세요.`
* 구매 수량이 재고 수량을 초과한 경우: `[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.`
* 기타 잘못된 입력의 경우: `[ERROR] 잘못된 입력입니다. 다시 입력해 주세요.`